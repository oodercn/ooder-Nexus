<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç½‘ç»œæ¦‚è§ˆ - Nexus</title>
    <link rel="stylesheet" href="/console/css/remixicon/remixicon.css">`n    <link rel="stylesheet" href="/console/css/theme.css">`n    <link rel="stylesheet" href="/console/css/dashboard.css">`n    <link rel="stylesheet" href="/console/css/styles.css">
    <link rel="stylesheet" href="/console/css/theme.css">
    <script src="/console/js/theme-manager.js"></script>
    <script src="/console/js/theme-manager.js"></script>`n    <script src="/console/js/menu-loader.js"></script>
    <script src="/console/js/common.js"></script>
</head>
<body>
    <div class="container">
        <!-- ä¾§è¾¹å¯¼èˆªæ ?-->
        <div class="sidebar">
            <h2 style="display: flex; align-items: center; gap: 12px;"><i class="ri-server-line"></i> Nexus Console</h2>
            <ul class="nav-menu" id="nav-menu"></ul>
        </div>
        
        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main-content">
            <!-- å¤´éƒ¨ -->
            <div class="header">
                <h1><i class="ri-dashboard-line"></i> ç½‘ç»œæ¦‚è§ˆ</h1>
                <div class="header-actions">
                    <button id="deviceSelector" class="btn btn-secondary" onclick="showDeviceSelector()">
                        <i class="ri-router-line"></i> <span id="currentDevice">ä¸»è·¯ç”±å™¨</span>
                    </button>
                    <button id="mockToggleBtn" class="btn btn-secondary" onclick="toggleMockMode()">
                        <i class="ri-bug-line"></i> æ¨¡æ‹Ÿæ¨¡å¼
                    </button>
                    <button class="theme-toggle-btn btn btn-secondary">
                        <i class="ri-sun-line"></i> æµ…è‰²æ¨¡å¼
                    </button>
                    <button id="refresh-btn" class="btn btn-primary" onclick="refreshData()">
                        <i class="ri-refresh-line"></i> åˆ·æ–°æ•°æ®
                    </button>
                </div>
            </div>
            
            <!-- è®¾å¤‡çŠ¶æ€æ¦‚è§?-->
            <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px;">
                <div class="card status-card">
                    <div class="status-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <i class="ri-router-line"></i>
                    </div>
                    <div class="status-value" id="deviceCount">3</div>
                    <div class="status-label">ç½‘ç»œè®¾å¤‡</div>
                </div>
                
                <div class="card status-card">
                    <div class="status-icon" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                        <i class="ri-wifi-line"></i>
                    </div>
                    <div class="status-value" id="onlineDevices">12</div>
                    <div class="status-label">åœ¨çº¿è®¾å¤‡</div>
                </div>
                
                <div class="card status-card">
                    <div class="status-icon" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                        <i class="ri-speed-line"></i>
                    </div>
                    <div class="status-value" id="bandwidthUsage">45%</div>
                    <div class="status-label">å¸¦å®½ä½¿ç”¨</div>
                </div>
                
                <div class="card status-card">
                    <div class="status-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                        <i class="ri-shield-check-line"></i>
                    </div>
                    <div class="status-value" id="securityStatus">æ­£å¸¸</div>
                    <div class="status-label">å®‰å…¨çŠ¶æ€?/div>
                </div>
            </div>
            
            <!-- è¿æ¥çŠ¶æ€å¡ç‰?-->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><i class="ri-router-line"></i> è®¾å¤‡è¿æ¥çŠ¶æ€?/h2>
                    <span id="connectionStatus" class="status-badge status-online">å·²è¿æ?/span>
                </div>
                <div id="deviceInfo">
                    <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); margin-top: 15px;">
                        <div class="info-item">
                            <span class="info-label">è®¾å¤‡åœ°å€</span>
                            <span id="deviceHost" class="info-value">192.168.1.1</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">å›ºä»¶ç‰ˆæœ¬</span>
                            <span id="firmwareVersion" class="info-value">OpenWrt 21.02.3</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">è¿è¡Œæ—¶é—´</span>
                            <span id="uptime" class="info-value">15å¤?3å°æ—¶</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">è®¾å¤‡å‹å·</span>
                            <span id="deviceModel" class="info-value">Xiaomi AX3600</span>
                        </div>
                    </div>
                </div>
                <div class="action-buttons" style="margin-top: 20px; display: flex; gap: 10px;">
                    <button id="connectBtn" class="btn btn-primary" onclick="showConnectModal()" style="display: none;">
                        <i class="ri-link"></i> è¿æ¥è®¾å¤‡
                    </button>
                    <button id="disconnectBtn" class="btn btn-danger" onclick="disconnectDevice()">
                        <i class="ri-unlink"></i> æ–­å¼€è¿æ¥
                    </button>
                    <button id="rebootBtn" class="btn btn-warning" onclick="rebootDevice()">
                        <i class="ri-restart-line"></i> é‡å¯è®¾å¤‡
                    </button>
                </div>
            </div>
            
            <!-- ç½‘ç»œæ‹“æ‰‘ -->
            <div class="card" style="margin-top: 20px;">
                <div class="card-header">
                    <h2 class="card-title"><i class="ri-global-line"></i> ç½‘ç»œæ‹“æ‰‘</h2>
                    <button class="btn btn-secondary" onclick="viewFullTopology()">
                        <i class="ri-fullscreen-line"></i> æŸ¥çœ‹å®Œæ•´æ‹“æ‰‘
                    </button>
                </div>
                <div class="network-topology" style="height: 300px;">
                    <div class="topology-diagram" style="height: 100%;">
                        <svg width="100%" height="100%" viewBox="0 0 800 250">
                            <!-- è·¯ç”±å™?-->
                            <circle cx="400" cy="50" r="30" fill="var(--nexus-primary)" stroke="var(--nexus-dark)" stroke-width="2" />
                            <text x="400" y="55" text-anchor="middle" fill="white" font-size="14" font-weight="600">è·¯ç”±å™?/text>
                            
                            <!-- äº¤æ¢æœ?-->
                            <rect x="300" y="120" width="200" height="40" rx="5" fill="var(--nexus-secondary)" stroke="var(--nexus-dark)" stroke-width="2" />
                            <text x="400" y="145" text-anchor="middle" fill="white" font-size="14" font-weight="600">äº¤æ¢æœ?/text>
                            
                            <!-- è®¾å¤‡1 -->
                            <rect x="150" y="200" width="100" height="30" rx="5" fill="var(--nexus-success)" stroke="var(--nexus-dark)" stroke-width="2" />
                            <text x="200" y="220" text-anchor="middle" fill="white" font-size="12">PC 1</text>
                            
                            <!-- è®¾å¤‡2 -->
                            <rect x="300" y="200" width="100" height="30" rx="5" fill="var(--nexus-success)" stroke="var(--nexus-dark)" stroke-width="2" />
                            <text x="350" y="220" text-anchor="middle" fill="white" font-size="12">PC 2</text>
                            
                            <!-- è®¾å¤‡3 -->
                            <rect x="450" y="200" width="100" height="30" rx="5" fill="var(--nexus-warning)" stroke="var(--nexus-dark)" stroke-width="2" />
                            <text x="500" y="220" text-anchor="middle" fill="white" font-size="12">æ‰“å°æœ?/text>
                            
                            <!-- è®¾å¤‡4 -->
                            <rect x="600" y="200" width="100" height="30" rx="5" fill="var(--nexus-danger)" stroke="var(--nexus-dark)" stroke-width="2" />
                            <text x="650" y="220" text-anchor="middle" fill="white" font-size="12">NAS</text>
                            
                            <!-- è¿æ¥çº?-->
                            <line x1="400" y1="80" x2="400" y2="120" stroke="var(--nexus-dark)" stroke-width="2" />
                            <line x1="300" y1="160" x2="200" y2="200" stroke="var(--nexus-dark)" stroke-width="2" />
                            <line x1="350" y1="160" x2="350" y2="200" stroke="var(--nexus-dark)" stroke-width="2" />
                            <line x1="450" y1="160" x2="500" y2="200" stroke="var(--nexus-dark)" stroke-width="2" />
                            <line x1="500" y1="160" x2="650" y2="200" stroke="var(--nexus-dark)" stroke-width="2" />
                        </svg>
                    </div>
                </div>
            </div>
            
            <!-- å¿«æ·æ“ä½œ -->
            <h3 style="margin: 30px 0 15px; color: var(--nexus-text);">å¿«æ·æ“ä½œ</h3>
            <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                <div class="card status-card" onclick="navigateTo('network-config')" style="cursor: pointer;">
                    <div class="status-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <i class="ri-settings-3-line"></i>
                    </div>
                    <div class="status-value">ç½‘ç»œé…ç½®</div>
                    <div class="status-label">é…ç½®ç½‘ç»œå‚æ•°</div>
                </div>
                <div class="card status-card" onclick="navigateTo('ip-management')" style="cursor: pointer;">
                    <div class="status-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <i class="ri-computer-line"></i>
                    </div>
                    <div class="status-value">IPåœ°å€ç®¡ç†</div>
                    <div class="status-label">ç®¡ç†IPåœ°å€åˆ†é…</div>
                </div>
                <div class="card status-card" onclick="navigateTo('device-assets')" style="cursor: pointer;">
                    <div class="status-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                        <i class="ri-list-check"></i>
                    </div>
                    <div class="status-value">è®¾å¤‡èµ„äº§</div>
                    <div class="status-label">æŸ¥çœ‹ç½‘ç»œè®¾å¤‡</div>
                </div>
                <div class="card status-card" onclick="navigateTo('traffic-monitor')" style="cursor: pointer;">
                    <div class="status-icon" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                        <i class="ri-equalizer-line"></i>
                    </div>
                    <div class="status-value">æµé‡ç›‘æ§</div>
                    <div class="status-label">ç›‘æ§å¸¦å®½ä½¿ç”¨</div>
                </div>
                <div class="card status-card" onclick="navigateTo('access-control')" style="cursor: pointer;">
                    <div class="status-icon" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                        <i class="ri-shield-cross-line"></i>
                    </div>
                    <div class="status-value">è®¿é—®æ§åˆ¶</div>
                    <div class="status-label">ç®¡ç†è®¿é—®æƒé™</div>
                </div>
                <div class="card status-card" onclick="navigateTo('remote-terminal')" style="cursor: pointer;">
                    <div class="status-icon" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">
                        <i class="ri-terminal-line"></i>
                    </div>
                    <div class="status-value">è¿œç¨‹ç»ˆç«¯</div>
                    <div class="status-label">æ‰§è¡Œè¿œç¨‹å‘½ä»¤</div>
                </div>
            </div>
        </div>
    </div>

    <!-- è®¾å¤‡é€‰æ‹©å™¨æ¨¡æ€æ¡† -->
    <div id="deviceSelectorModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3 class="modal-title">é€‰æ‹©ç½‘ç»œè®¾å¤‡</h3>
                <button class="modal-close" onclick="hideDeviceSelector()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="device-list" id="deviceList">
                    <div class="device-item" onclick="selectDevice('router1')" style="padding: 12px; border: 1px solid var(--nexus-border); border-radius: 8px; margin-bottom: 8px; cursor: pointer;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <i class="ri-router-line" style="font-size: 24px; color: var(--nexus-primary);"></i>
                            <div>
                                <div style="font-weight: 600;">ä¸»è·¯ç”±å™¨</div>
                                <div style="font-size: 12px; color: var(--nexus-secondary);">192.168.1.1</div>
                            </div>
                        </div>
                    </div>
                    <div class="device-item" onclick="selectDevice('switch1')" style="padding: 12px; border: 1px solid var(--nexus-border); border-radius: 8px; margin-bottom: 8px; cursor: pointer;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <i class="ri-exchange-line" style="font-size: 24px; color: var(--nexus-secondary);"></i>
                            <div>
                                <div style="font-weight: 600;">æ ¸å¿ƒäº¤æ¢æœ?/div>
                                <div style="font-size: 12px; color: var(--nexus-secondary);">192.168.1.2</div>
                            </div>
                        </div>
                    </div>
                    <div class="device-item" onclick="selectDevice('ap1')" style="padding: 12px; border: 1px solid var(--nexus-border); border-radius: 8px; cursor: pointer;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <i class="ri-wifi-line" style="font-size: 24px; color: var(--nexus-success);"></i>
                            <div>
                                <div style="font-weight: 600;">æ— çº¿AP</div>
                                <div style="font-size: 12px; color: var(--nexus-secondary);">192.168.1.3</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- è¿æ¥æ¨¡æ€æ¡† -->
    <div id="connectModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3 class="modal-title">è¿æ¥ç½‘ç»œè®¾å¤‡</h3>
                <button class="modal-close" onclick="hideConnectModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">è®¾å¤‡åœ°å€</label>
                    <input type="text" id="hostInput" class="form-input" placeholder="192.168.1.1" value="192.168.1.1">
                </div>
                <div class="form-group">
                    <label class="form-label">ç”¨æˆ·å?/label>
                    <input type="text" id="usernameInput" class="form-input" placeholder="root" value="root">
                </div>
                <div class="form-group">
                    <label class="form-label">å¯†ç </label>
                    <input type="password" id="passwordInput" class="form-input" placeholder="å¯†ç ">
                </div>
                <div class="form-group">
                    <label class="form-label">è®¾å¤‡ç±»å‹</label>
                    <select id="deviceTypeInput" class="form-select">
                        <option value="openwrt">OpenWrt è·¯ç”±å™?/option>
                        <option value="switch">äº¤æ¢æœ?/option>
                        <option value="ap">æ— çº¿AP</option>
                        <option value="other">å…¶ä»–è®¾å¤‡</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideConnectModal()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="connectDevice()">è¿æ¥</button>
            </div>
        </div>
    </div>

    <script>
        let currentDeviceId = 'router1';
        let isMockMode = false;
        
        // é¡µé¢åˆå§‹åŒ?        async function init() {
            await loadDeviceStats();
        }
        
        // ä»APIåŠ è½½è®¾å¤‡ç»Ÿè®¡æ•°æ®
        async function loadDeviceStats() {
            try {
                // è·å–è®¾å¤‡åˆ—è¡¨
                const devicesResponse = await fetch('/api/devices/list');
                const devicesResult = await devicesResponse.json();
                
                if (devicesResult.code === 200 && devicesResult.data) {
                    const stats = devicesResult.data.stats;
                    const devices = devicesResult.data.devices;
                    
                    // æ›´æ–°ç»Ÿè®¡å¡ç‰‡
                    document.getElementById('deviceCount').textContent = stats.total || 0;
                    document.getElementById('onlineDevices').textContent = stats.online || 0;
                    
                    // æ›´æ–°è®¾å¤‡åˆ—è¡¨
                    updateDeviceSelector(devices);
                }
                
                // è·å–å‘½ä»¤ç»Ÿè®¡
                const statsResponse = await fetch('/api/command/stats');
                const statsResult = await statsResponse.json();
                
                if (statsResult.code === 200 && statsResult.data) {
                    // å¯ä»¥åœ¨è¿™é‡Œæ›´æ–°æ›´å¤šç»Ÿè®¡ä¿¡æ?                    console.log('å‘½ä»¤ç»Ÿè®¡:', statsResult.data);
                }
            } catch (error) {
                console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
            }
        }
        
        // æ›´æ–°è®¾å¤‡é€‰æ‹©å™?        function updateDeviceSelector(devices) {
            const deviceList = document.getElementById('deviceList');
            if (!deviceList || devices.length === 0) return;
            
            deviceList.innerHTML = devices.slice(0, 5).map(device => `
                <div class="device-item" onclick="selectDevice('${device.id}')" style="padding: 12px; border: 1px solid var(--nexus-border); border-radius: 8px; margin-bottom: 8px; cursor: pointer;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <i class="ri-${getDeviceIcon(device.type)}" style="font-size: 24px; color: var(--nexus-primary);"></i>
                        <div>
                            <div style="font-weight: 600;">${device.name}</div>
                            <div style="font-size: 12px; color: var(--nexus-secondary);">${device.id}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // è·å–è®¾å¤‡å›¾æ ‡
        function getDeviceIcon(type) {
            const iconMap = {
                router: 'router-line',
                switch: 'exchange-line',
                pc: 'computer-line',
                printer: 'printer-line',
                nas: 'hard-drive-line',
                light: 'lightbulb-line',
                socket: 'plug-line',
                lock: 'lock-line',
                sensor: 'sensor-line',
                other: 'device-line'
            };
            return iconMap[type] || 'device-line';
        }

        // æ˜¾ç¤ºè®¾å¤‡é€‰æ‹©å™?        function showDeviceSelector() {
            document.getElementById('deviceSelectorModal').style.display = 'flex';
        }

        // éšè—è®¾å¤‡é€‰æ‹©å™?        function hideDeviceSelector() {
            document.getElementById('deviceSelectorModal').style.display = 'none';
        }

        // é€‰æ‹©è®¾å¤‡
        function selectDevice(deviceId) {
            currentDeviceId = deviceId;
            const deviceNames = {
                'router1': 'ä¸»è·¯ç”±å™¨',
                'switch1': 'æ ¸å¿ƒäº¤æ¢æœ?,
                'ap1': 'æ— çº¿AP'
            };
            document.getElementById('currentDevice').textContent = deviceNames[deviceId] || deviceId;
            hideDeviceSelector();
            refreshData();
        }

        // æ˜¾ç¤ºè¿æ¥æ¨¡æ€æ¡†
        function showConnectModal() {
            document.getElementById('connectModal').style.display = 'flex';
        }

        // éšè—è¿æ¥æ¨¡æ€æ¡†
        function hideConnectModal() {
            document.getElementById('connectModal').style.display = 'none';
        }

        // è¿æ¥è®¾å¤‡
        function connectDevice() {
            const host = document.getElementById('hostInput').value;
            const username = document.getElementById('usernameInput').value;
            const password = document.getElementById('passwordInput').value;
            const deviceType = document.getElementById('deviceTypeInput').value;
            
            // æ¨¡æ‹Ÿè¿æ¥
            setTimeout(() => {
                document.getElementById('connectionStatus').textContent = 'å·²è¿æ?;
                document.getElementById('connectionStatus').className = 'status-badge status-online';
                document.getElementById('deviceHost').textContent = host;
                hideConnectModal();
                alert('è®¾å¤‡è¿æ¥æˆåŠŸï¼?);
            }, 1000);
        }

        // æ–­å¼€è®¾å¤‡è¿æ¥
        function disconnectDevice() {
            if (confirm('ç¡®å®šè¦æ–­å¼€è®¾å¤‡è¿æ¥å—ï¼Ÿ')) {
                document.getElementById('connectionStatus').textContent = 'æœªè¿æ?;
                document.getElementById('connectionStatus').className = 'status-badge status-offline';
                alert('è®¾å¤‡å·²æ–­å¼€è¿æ¥');
            }
        }

        // é‡å¯è®¾å¤‡
        function rebootDevice() {
            if (confirm('ç¡®å®šè¦é‡å¯è®¾å¤‡å—ï¼?)) {
                alert('è®¾å¤‡é‡å¯å‘½ä»¤å·²å‘é€?);
            }
        }

        // åˆ·æ–°æ•°æ®
        function refreshData() {
            const btn = document.getElementById('refresh-btn');
            btn.innerHTML = '<i class="ri-refresh-line ri-spin"></i> åˆ·æ–°ä¸?..';
            
            setTimeout(() => {
                btn.innerHTML = '<i class="ri-refresh-line"></i> åˆ·æ–°æ•°æ®';
                alert('æ•°æ®å·²åˆ·æ–?);
            }, 1000);
        }

        // åˆ‡æ¢æ¨¡æ‹Ÿæ¨¡å¼
        function toggleMockMode() {
            isMockMode = !isMockMode;
            const btn = document.getElementById('mockToggleBtn');
            if (isMockMode) {
                btn.classList.add('btn-warning');
                btn.innerHTML = '<i class="ri-bug-line"></i> æ¨¡æ‹Ÿæ¨¡å¼: å¼€';
            } else {
                btn.classList.remove('btn-warning');
                btn.innerHTML = '<i class="ri-bug-line"></i> æ¨¡æ‹Ÿæ¨¡å¼';
            }
        }

        // é¡µé¢å¯¼èˆª
        function navigateTo(page) {
            window.location.href = page + '.html';
        }

        // æŸ¥çœ‹å®Œæ•´æ‹“æ‰‘
        function viewFullTopology() {
            window.location.href = '/console/pages/nexus/network-topology.html';
        }

        // åˆå§‹åŒ?        document.addEventListener('DOMContentLoaded', function() {
            init();
        });
    </script>
</body>
</html>
