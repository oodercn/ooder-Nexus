<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P2P网络可视化 - Nexus Console</title>
    
    <link rel="stylesheet" href="/console/css/remixicon/remixicon.css">
    <link rel="stylesheet" href="/console/css/nexus.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <div class="nx-page">
        <aside class="nx-page__sidebar">
            <div class="nx-p-4 nx-mb-4">
                <h1 class="nx-text-lg nx-font-bold" style="display: flex; align-items: center; gap: 8px;">
                    <i class="ri-server-line"></i> Nexus Console
                </h1>
            </div>
            <ul class="nav-menu" id="nav-menu"></ul>
        </aside>
        
        <main class="nx-page__content">
            <header class="nx-page__header">
                <div class="nx-flex nx-items-center nx-gap-3">
                    <button class="nx-btn nx-btn--ghost nx-btn--icon" data-nx-sidebar-toggle>
                        <i class="ri-menu-line"></i>
                    </button>
                    <h2 class="nx-text-lg nx-font-semibold">P2P网络可视化</h2>
                </div>
                <div class="nx-flex nx-items-center nx-gap-3">
                    <button class="nx-btn nx-btn--ghost nx-btn--icon" data-nx-theme-toggle>
                        <i class="ri-sun-line"></i>
                    </button>
                    <button class="nx-btn nx-btn--secondary" onclick="resetZoom()">
                        <i class="ri-focus-3-line"></i> 重置视图
                    </button>
                    <button class="nx-btn nx-btn--primary" onclick="discoverNodes()">
                        <i class="ri-search-line"></i> 发现节点
                    </button>
                </div>
            </header>
            
            <div class="nx-page__main">
                <div class="nx-container">
                    <div class="nx-grid nx-grid-cols-4 nx-mb-6">
                        <div class="nx-stat-card">
                            <div class="nx-stat-card__icon nx-stat-card__icon--primary">
                                <i class="ri-node-tree-line"></i>
                            </div>
                            <div class="nx-stat-card__content">
                                <div class="nx-stat-card__label">总节点</div>
                                <div class="nx-stat-card__value" id="stat-nodes">0</div>
                            </div>
                        </div>
                        <div class="nx-stat-card">
                            <div class="nx-stat-card__icon nx-stat-card__icon--success">
                                <i class="ri-checkbox-circle-line"></i>
                            </div>
                            <div class="nx-stat-card__content">
                                <div class="nx-stat-card__label">在线节点</div>
                                <div class="nx-stat-card__value" id="stat-online">0</div>
                            </div>
                        </div>
                        <div class="nx-stat-card">
                            <div class="nx-stat-card__icon nx-stat-card__icon--warning">
                                <i class="ri-packet-line"></i>
                            </div>
                            <div class="nx-stat-card__content">
                                <div class="nx-stat-card__label">数据包</div>
                                <div class="nx-stat-card__value" id="stat-packets">0</div>
                            </div>
                        </div>
                        <div class="nx-stat-card">
                            <div class="nx-stat-card__icon nx-stat-card__icon--info">
                                <i class="ri-apps-line"></i>
                            </div>
                            <div class="nx-stat-card__content">
                                <div class="nx-stat-card__label">技能数</div>
                                <div class="nx-stat-card__value" id="stat-skills">0</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="nx-card">
                        <div class="nx-card__header">
                            <h3 class="nx-card__title">网络拓扑</h3>
                            <button class="nx-btn nx-btn--secondary" onclick="refreshTopology()">
                                <i class="ri-refresh-line"></i> 刷新
                            </button>
                        </div>
                        <div class="nx-card__body">
                            <div id="topologyGraph" style="width: 100%; height: 400px; background: var(--nx-bg-elevated); border-radius: 8px;">
                                <svg id="topology-svg" width="100%" height="100%"></svg>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <script src="/console/js/nexus.js"></script>
    <script src="/console/js/nexus-menu.js"></script>
    <script src="/console/js/page-init.js" data-auto-init></script>
    <script>
        const networkData = {
            nodes: [
                { id: 'node-001', name: '主节点', type: 'self', status: 'active', x: 400, y: 100 },
                { id: 'node-002', name: '节点A', type: 'active', status: 'active', x: 200, y: 200 },
                { id: 'node-003', name: '节点B', type: 'active', status: 'active', x: 600, y: 200 },
                { id: 'node-004', name: '节点C', type: 'active', status: 'active', x: 100, y: 300 },
                { id: 'node-005', name: '节点D', type: 'inactive', status: 'inactive', x: 300, y: 300 },
                { id: 'node-006', name: '节点E', type: 'active', status: 'active', x: 500, y: 300 },
                { id: 'node-007', name: '节点F', type: 'active', status: 'active', x: 700, y: 300 }
            ],
            links: [
                { source: 'node-001', target: 'node-002' },
                { source: 'node-001', target: 'node-003' },
                { source: 'node-002', target: 'node-004' },
                { source: 'node-002', target: 'node-005' },
                { source: 'node-003', target: 'node-006' },
                { source: 'node-003', target: 'node-007' }
            ]
        };
        
        window.onPageInit = function() {
            console.log('P2P网络可视化页面初始化完成');
            renderTopology();
            updateStats();
        };
        
        function renderTopology() {
            const svg = document.getElementById('topology-svg');
            svg.innerHTML = '';
            
            networkData.links.forEach(link => {
                const source = networkData.nodes.find(n => n.id === link.source);
                const target = networkData.nodes.find(n => n.id === link.target);
                if (source && target) {
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', source.x);
                    line.setAttribute('y1', source.y);
                    line.setAttribute('x2', target.x);
                    line.setAttribute('y2', target.y);
                    line.setAttribute('stroke', 'var(--nx-border)');
                    line.setAttribute('stroke-width', '2');
                    svg.appendChild(line);
                }
            });
            
            networkData.nodes.forEach(node => {
                const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                const color = node.type === 'self' ? '#3b82f6' : node.status === 'active' ? '#22c55e' : '#ef4444';
                
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', node.x);
                circle.setAttribute('cy', node.y);
                circle.setAttribute('r', '20');
                circle.setAttribute('fill', color);
                
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', node.x);
                text.setAttribute('y', node.y + 35);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('fill', 'var(--nx-text-primary)');
                text.setAttribute('font-size', '12');
                text.textContent = node.name;
                
                g.appendChild(circle);
                g.appendChild(text);
                svg.appendChild(g);
            });
        }
        
        function updateStats() {
            document.getElementById('stat-nodes').textContent = networkData.nodes.length;
            document.getElementById('stat-online').textContent = networkData.nodes.filter(n => n.status === 'active').length;
            document.getElementById('stat-packets').textContent = Math.floor(Math.random() * 1000);
            document.getElementById('stat-skills').textContent = Math.floor(Math.random() * 50);
        }
        
        function refreshTopology() {
            renderTopology();
            updateStats();
        }
        
        function resetZoom() {
            renderTopology();
        }
        
        function discoverNodes() {
            alert('正在发现新节点...');
        }
        
        function loadSkillMarket() {
            alert('加载技能市场...');
        }
    </script>
</body>
</html>
