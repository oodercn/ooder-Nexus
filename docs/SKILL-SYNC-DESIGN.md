# 技能同步模块设计文档

## 概述

技能同步模块（Skill Sync Module）是 ooderNexus 的核心功能模块之一，参考 agent-skillcenter 设计，支持个人使用和小规模办公场景下的技能分享与同步。

## 设计目标

1. **个人使用**：支持个人在多设备间同步技能
2. **小规模分享**：支持小团队、家庭、部门内部的技能分享
3. **简单易用**：提供直观的Web界面，无需复杂配置
4. **安全可靠**：支持本地优先，数据可控

## 架构设计

### 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                     技能同步模块                              │
├─────────────────────────────────────────────────────────────┤
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │   同步任务    │  │   技能管理    │  │   统计分析    │      │
│  │   管理       │  │              │  │              │      │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘      │
│         │                 │                 │              │
│  ┌──────┴─────────────────┴─────────────────┴──────┐      │
│  │              技能同步服务层                       │      │
│  │         (SkillSyncService)                       │      │
│  └──────┬─────────────────┬─────────────────┬──────┘      │
│         │                 │                 │              │
│  ┌──────┴──────┐  ┌──────┴──────┐  ┌──────┴──────┐      │
│  │  任务管理    │  │  技能存储    │  │  同步引擎    │      │
│  │              │  │              │  │              │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
└─────────────────────────────────────────────────────────────┘
```

### 核心组件

#### 1. 控制器层 (Controller)

**SkillSyncController**
- 提供 RESTful API 接口
- 处理 HTTP 请求和响应
- 支持 UTF-8 编码

主要接口：
| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/sync/tasks` | GET | 获取所有同步任务 |
| `/api/sync/tasks` | POST | 创建同步任务 |
| `/api/sync/tasks/{id}/execute` | POST | 执行同步任务 |
| `/api/sync/tasks/{id}/cancel` | POST | 取消同步任务 |
| `/api/sync/tasks/{id}` | DELETE | 删除同步任务 |
| `/api/sync/statistics` | GET | 获取同步统计 |
| `/api/sync/skills/syncable` | GET | 获取可同步技能 |
| `/api/sync/skills/upload` | POST | 上传技能 |
| `/api/sync/skills/download` | POST | 下载技能 |
| `/api/sync/batch` | POST | 批量同步 |

#### 2. 服务层 (Service)

**SkillSyncService (接口)**
- 定义技能同步的核心业务逻辑
- 提供任务管理、技能管理、统计分析功能

**SkillSyncServiceImpl (实现)**
- 内存存储实现（适合个人使用）
- 支持任务状态管理
- 支持进度跟踪

#### 3. 数据模型 (Model)

**SyncTask (同步任务)**
```java
- id: 任务ID
- name: 任务名称
- type: 任务类型 (upload/download/bidirectional)
- status: 任务状态 (pending/running/completed/failed/cancelled)
- source: 源位置
- target: 目标位置
- totalItems: 总项目数
- processedItems: 已处理项目数
- failedItems: 失败项目数
- errorMessage: 错误信息
- createTime: 创建时间
- startTime: 开始时间
- endTime: 结束时间
- items: 同步项列表
```

**SyncItem (同步项)**
```java
- id: 项目ID
- name: 项目名称
- type: 项目类型 (skill/category/config)
- status: 同步状态 (pending/syncing/completed/failed)
- errorMessage: 错误信息
- syncTime: 同步时间
```

**SyncableSkill (可同步技能)**
```java
- id: 技能ID
- name: 技能名称
- description: 技能描述
- version: 版本号
- category: 分类
- size: 文件大小
- lastModified: 最后修改时间
- synced: 是否已同步
```

**SyncedSkill (已同步技能)**
```java
- id: 技能ID
- name: 技能名称
- description: 技能描述
- version: 版本号
- category: 分类
- syncDirection: 同步方向 (upload/download)
- syncTime: 同步时间
- syncStatus: 同步状态
```

## 功能设计

### 1. 同步任务管理

#### 任务生命周期

```
创建 (pending) -> 执行 (running) -> 完成 (completed)
                                    -> 失败 (failed)
                                    -> 取消 (cancelled)
```

#### 任务类型

| 类型 | 说明 | 使用场景 |
|------|------|---------|
| upload | 上传到云端 | 备份技能到云端 |
| download | 下载到本地 | 从云端恢复技能 |
| bidirectional | 双向同步 | 多设备间同步 |

### 2. 技能管理

#### 技能分类

- **个人技能**：用户自己创建的技能
- **下载技能**：从其他节点下载的技能
- **系统技能**：系统内置的技能

#### 技能状态

| 状态 | 说明 |
|------|------|
| 未同步 | 仅在本地存在 |
| 已上传 | 已上传到云端 |
| 已下载 | 已从云端下载 |
| 冲突 | 本地和云端版本不一致 |

### 3. 同步策略

#### 增量同步

- 只同步变更的部分
- 基于时间戳判断变更
- 支持断点续传

#### 冲突解决

- 时间戳优先：使用最新的版本
- 手动选择：让用户选择保留哪个版本
- 自动合并：尝试自动合并（仅配置文件）

## 前端设计

### 页面结构

```
skillcenter-sync/
├── sync-dashboard.html      # 同步概览页面
├── sync-status.html         # 同步状态页面
├── skill-categories.html    # 技能分类页面
├── skill-download.html      # 技能下载页面
└── skill-upload.html        # 技能上传页面
```

### 同步概览页面

**功能区域**：
1. **统计卡片**：显示总任务、已完成、进行中、已同步技能、成功率
2. **标签页**：
   - 同步任务：任务列表、状态过滤、操作按钮
   - 技能管理：技能卡片、批量选择、批量同步
   - 同步历史：历史记录、时间线

**交互设计**：
- 实时刷新任务状态
- 进度条显示同步进度
- 状态指示器显示任务状态

## API 设计

### 响应格式

```json
{
  "success": true,
  "code": "200",
  "message": "操作成功",
  "data": { ... },
  "timestamp": 1770711693058
}
```

### 错误处理

- 使用统一的错误码
- 详细的错误信息
- 日志记录

## 存储设计

### 当前实现

- 内存存储（适合个人使用）
- 启动时初始化默认数据
- 支持数据导出/导入

### 未来扩展

- 本地文件存储
- 数据库存储（SQLite/H2）
- 云端存储对接

## 安全设计

### 访问控制

- 基于会话的身份验证
- 操作权限检查

### 数据安全

- 本地优先：数据默认存储在本地
- 传输加密：支持 HTTPS
- 数据验证：输入数据校验

## 性能设计

### 优化策略

- 分页加载：大量数据分页显示
- 懒加载：按需加载技能详情
- 缓存：技能列表本地缓存

### 限制

- 单任务最大技能数：100
- 最大并发任务数：3
- 任务保留时间：30天

## 部署场景

### 个人使用

- 单设备部署
- 本地存储
- 手动同步

### 家庭/小团队

- 多设备部署
- 指定一台设备作为中心节点
- 自动发现其他节点

### 部门内部

- 服务器部署
- 定期备份
- 权限管理

## 开发计划

### 当前版本 (v1.0)

- [x] 基础同步功能
- [x] 任务管理
- [x] 技能管理
- [x] Web界面

### 未来版本

- [ ] 云端存储对接
- [ ] 自动同步策略
- [ ] 冲突自动解决
- [ ] 技能版本管理
- [ ] 团队协作功能

## 相关文档

- [技能同步使用说明](SKILL-SYNC-GUIDE.md)
- [API接口文档](API-MANUAL.md)
- [技能开发指南](SKILL-DEVELOPMENT.md)
